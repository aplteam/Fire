 R←Test_Replace_230(stopFlag batchFlag);n;n2;⎕TRAP;buffer;search;code;msg
⍝ Replace "⎕IO" in "⎕IO ⎕ML←1" - that caused once an endless loop in the "Preview" report.
 ⎕TRAP←(999 'C' '. ⍝ Deliberate error')(0 'N')
 R←∆Failed

 #.⎕SHADOW'TEMP'
 'TEMP'#.⎕NS''
 buffer←⊂':Class Foo'
 buffer,←⊂'⎕IO ⎕ML←1'
 buffer,←⊂':EndClass'
 #.TEMP.⎕FIX buffer

 1 #._Fire.Fire.Run 0
 n←#._Fire.Fire.GUI.n

 n.SearchFor.Text←'⎕IO'
 n.LookIn.Text←'#.TEMP'
 n.ReuseSearch.State←0

 {}∆Select n.StartBtn
 0.2 ∆Process n.Form
 →GoToTidyUp 1≠#._Fire.Fire.G.NoOfObjects
 →GoToTidyUp~n.HitList.Items Match⊂'Foo'

 {}∆Select n.ReplaceBtn
 ∆Process n.Form

 n2←#._Fire.Fire.Replace.n
 {}∆Select n2.StartBtn
 ∆Process n.Form

 →GoToTidyUp 1≠#._Fire.Fire.Replace.NoOfReplacements
 code←⎕SRC #.TEMP.Foo
 →GoToTidyUp~∨/'⎕ML←1'∘≡¨code~¨' '
 R←∆OK='Test okay?'#._Fire.Fire.Question.YesOrNo'Did the report look okay?'

∆TidyUp:
 CloseFire
