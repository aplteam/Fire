 R←Test_Replace_231(stopFlag batchFlag);n;n2;⎕TRAP;buffer;search;code;msg
⍝ Replace "⎕IO←0" by "⎕IO←1" - in a script that has a recursive dfns call with ∇ in it.
⍝ Such a recursive call once caused a bug problem when there nothing to the left of ∇, mis-interpreting
⍝ this as the beginning of a tfns.
 ⎕TRAP←(999 'C' '. ⍝ Deliberate error')(0 'N')
 R←∆Failed

 #.⎕SHADOW'TEMP'
 'TEMP'#.⎕NS''
 buffer←⊂':Class Foo'
 buffer,←⊂'⎕IO←0'
 buffer,←⊂'∇r←Hello;⎕IO'
 buffer,←⊂'⎕IO←0'
 buffer,←⊂'r←''Universe'''
 buffer,←⊂'∇'
 buffer,←⊂'rotate←{'
 buffer,←⊂'⎕IO←1'
 buffer,←⊂'r←{⌽⍵}⍵'
 buffer,←⊂'∇ r'
 buffer,←⊂'}'
 buffer,←⊂'∇r←Hello2;⎕IO'
 buffer,←⊂'⎕IO←0'
 buffer,←⊂'r←''World'''
 buffer,←⊂'r←{⎕IO←0 ⋄ ⌽{⌽⌽⍵}⌽}r'
 buffer,←⊂'∇'
 buffer,←⊂':EndClass'
 #.TEMP.⎕FIX buffer

 1 #._Fire.Fire.Run 0
 n←#._Fire.Fire.GUI.n

 ∆InitialyzeFireMainGUI_Settings n
 n.SearchFor.Text←'⎕IO←0'
 n.LookIn.Text←'#.TEMP'

 {}∆Select n.StartBtn
 1 ∆Process n.Form
 →GoToTidyUp 1≠#._Fire.Fire.G.NoOfObjects
 →GoToTidyUp~n.HitList.Items Match⊂'Foo'

 {}∆Select n.ReplaceBtn
 ∆Process n.Form

 n2←#._Fire.Fire.Replace.n
 ∆InitialyzeFireReplaceGUI_Settings n2
 n2.ReplaceBy.Text←'⎕io←0'

 {}∆Select n2.StartBtn
 ∆Process n.Form
 →GoToTidyUp 1≠#._Fire.Fire.Replace.NoOfReplacements
 code←⎕SRC #.TEMP.Foo
 →GoToTidyUp 3≠+/'⎕io←0'∘≡¨code~¨' '
 R←∆OK

∆TidyUp:
 CloseFire
